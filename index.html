<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>éœ²ç‡Ÿæ´»å‹•å ±åè¡¨</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
input, select, textarea { display: block; margin-bottom: 10px; width: 100%; padding: 8px; box-sizing: border-box; }
label { font-weight: bold; display: block; margin-bottom: 4px; }
.hint { font-size: 0.9em; color: gray; margin-top: -8px; margin-bottom: 8px; }
#userName { margin-bottom: 20px; font-weight: bold; color: green; text-align: center; }
.checkbox-group { display: flex; align-items: center; gap: 8px; }
button { padding: 10px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; }
button:hover { background-color: #45a049; }
</style>
</head>
<body>

<div id="userName">ğŸ”„ è¼‰å…¥ä¸­...</div>

<form id="campForm">
  <label for="name">å¡«å¯«è€…å§“å</label>
  <input type="text" id="name" name="name" placeholder="è‡ªå‹•å¸¶å…¥ LINE åç¨±" readonly required>

  <label for="campName">éœ²ç‡Ÿå ´æ¬¡åç¨±</label>
  <input type="text" id="campName" name="campName" placeholder="è«‹è¼¸å…¥éœ²ç‡Ÿå ´æ¬¡åç¨±" required>

  <label for="adults">å¤§äººäººæ•¸</label>
  <input type="number" id="adults" name="adults" placeholder="è«‹è¼¸å…¥å¤§äººäººæ•¸" min="0" required>

  <label for="halfPriceKids">åŠåƒ¹å°å­©äººæ•¸</label>
  <input type="number" id="halfPriceKids" name="halfPriceKids" placeholder="è«‹è¼¸å…¥åŠåƒ¹å°å­©äººæ•¸" min="0" required>
  <div class="hint">å°1ä»¥ä¸Šåˆ°é«˜ä¸­ï¼Œæ²’æœ‰å‰‡å¡« 0</div>

  <label for="freeKids">å¹¼ç¨šåœ’ä»¥ä¸‹å°å­©äººæ•¸</label>
  <input type="number" id="freeKids" name="freeKids" placeholder="è«‹è¼¸å…¥å¹¼ç¨šåœ’ä»¥ä¸‹å°å­©äººæ•¸" min="0" required>
  <div class="hint">æ²’æœ‰å‰‡å¡« 0</div>

  <label>æ˜¯å¦å¤œè¡</label>
  <div class="checkbox-group">
    <input type="checkbox" id="nightRush" name="nightRush">
    <label for="nightRush">æ˜¯</label>
  </div>

  <button type="submit">é€å‡ºå ±å</button>
</form>

<script>
const liffId = "YOUR_LIFF_ID_HERE";   // æ›¿æ›æˆä½ çš„ LIFF ID
const NOTION_API_KEY = "YOUR_NOTION_API_KEY_HERE"; // Notion API Key
const DATABASE_ID = "YOUR_DATABASE_ID_HERE";      // Notion Database ID

async function initLIFF() {
  await liff.init({ liffId });

  if (!liff.isLoggedIn()) {
    liff.login();
    return;
  }

  try {
    const profile = await liff.getProfile();
    const nameInput = document.getElementById("name");
    nameInput.value = profile.displayName; // å°‡ LINE åç¨±å¡«å…¥ input
    document.getElementById("userName").textContent = `ğŸ‘¤ ç›®å‰ç™»å…¥è€…ï¼š${profile.displayName}`;
  } catch (err) {
    document.getElementById("userName").textContent = "âš ï¸ ç„¡æ³•å–å¾—ä½¿ç”¨è€…è³‡è¨Š";
    console.error(err);
  }
}

// è¡¨å–®é€å‡º
document.getElementById("campForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const campName = document.getElementById("campName").value;
  const adults = parseInt(document.getElementById("adults").value) || 0;
  const halfPriceKids = parseInt(document.getElementById("halfPriceKids").value) || 0;
  const freeKids = parseInt(document.getElementById("freeKids").value) || 0;
  const nightRush = document.getElementById("nightRush").checked;

  try {
    const res = await fetch("https://api.notion.com/v1/pages", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${NOTION_API_KEY}`,
        "Content-Type": "application/json",
        "Notion-Version": "2022-06-28"
      },
      body: JSON.stringify({
        parent: { database_id: DATABASE_ID },
        properties: {
          "éœ²ç‡Ÿå ´æ¬¡åç¨±": { title: [{ text: { content: campName } }] },
          "å¡«å¯«è€…åç¨±": { rich_text: [{ text: { content: name } }] },
          "å¤§äººäººæ•¸": { number: adults },
          "åŠåƒ¹å°å­©äººæ•¸": { number: halfPriceKids },
          "å¹¼ç¨šåœ’ä»¥ä¸‹äººæ•¸": { number: freeKids },
          "æ˜¯å¦å¤œè¡": { checkbox: nightRush }
        }
      })
    });

    if (!res.ok) {
      const errData = await res.json();
      console.error("Notion API Error:", errData);
      alert("âŒ å ±åå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
      return;
    }

    alert("âœ… å ±åæˆåŠŸï¼");
    liff.closeWindow();

  } catch (err) {
    console.error("Error submitting form:", err);
    alert("âŒ ç³»çµ±ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
  }
});

initLIFF();
</script>
</body>
</html>
